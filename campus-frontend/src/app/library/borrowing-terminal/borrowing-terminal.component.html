<div class="terminal-shell">
  <!-- Ambient scanline overlay -->
  <div class="scanlines"></div>

  <!-- Top bar — clock + terminal ID -->
  <header class="top-bar">
    <div class="top-bar-left">
      <span class="pulse-dot"></span>
      <span class="terminal-id">LIBRARY TERMINAL</span>
    </div>
    <div class="top-bar-center">
      <span class="clock">{{ currentTime | date:'HH:mm:ss' }}</span>
    </div>
    <div class="top-bar-right">
      <span class="date-display">{{ currentTime | date:'EEEE, MMMM d, y' }}</span>
    </div>
  </header>

  <main class="terminal-main">

    <!-- ==================== BORROWING PANEL ==================== -->
    <div class="borrowing-panel">
      <div class="borrowing-glyph">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
      </div>
      <h1 class="borrowing-title">Book Borrowing System</h1>
      <p class="borrowing-subtitle">Enter student code and book ISBN to borrow</p>

      <form
        [formGroup]="form"
        (ngSubmit)="borrowBook()"
        class="borrowing-form"
      >
        <div class="field">
          <label for="student-code">Student Code</label>
          <div class="input-wrap">
            <svg class="field-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <input
              id="student-code"
              type="text"
              formControlName="student_code"
              placeholder="e.g. STU2024001"
              autocomplete="off"
              spellcheck="false"
              (focus)="clearMessages()"
            />
          </div>
        </div>

        <div class="field">
          <label for="isbn">Book ISBN</label>
          <div class="input-wrap">
            <svg class="field-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
            </svg>
            <input
              id="isbn"
              type="text"
              formControlName="isbn"
              placeholder="e.g. 978-3-16-148410-0"
              autocomplete="off"
              spellcheck="false"
              (focus)="clearMessages()"
            />
          </div>
        </div>

        <button class="btn-borrow" type="submit" [disabled]="loading">
          @if (loading) {
            <span class="spinner"></span>
            <span>Processing…</span>
          } @else {
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            <span>Borrow Book</span>
          }
        </button>

        @if (errorMessage) {
          <div class="error-banner">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
            <span>{{ errorMessage }}</span>
          </div>
        }

        @if (successMessage) {
          <div class="success-banner">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
            <span>{{ successMessage }}</span>
          </div>
        }
      </form>

      <!-- Book Info Display -->
      @if (borrowedBook) {
        <div class="book-info-card">
          <h3 class="book-info-title">Borrowed Book Details</h3>
          <div class="book-details">
            <div class="detail-row">
              <span class="detail-label">Student:</span>
              <span class="detail-value">{{ borrowedBook.student?.first_name }} {{ borrowedBook.student?.last_name }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Book:</span>
              <span class="detail-value">{{ borrowedBook.book_copy?.book?.title }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Author:</span>
              <span class="detail-value">{{ borrowedBook.book_copy?.book?.author }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ISBN:</span>
              <span class="detail-value">{{ borrowedBook.book_copy?.isbn }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Borrowed At:</span>
              <span class="detail-value">{{ borrowedBook.borrowed_at | date:'medium' }}</span>
            </div>
          </div>
        </div>
      }
    </div>

  </main>
</div>
