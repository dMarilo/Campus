<div class="set-password-container">
  <div class="set-password-background">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
  </div>

  <div class="container">
    <div class="row min-vh-100 align-items-center justify-content-center">
      <div class="col-lg-5 col-md-7 col-sm-9">
        <div class="set-password-card">

          <div class="text-center mb-4">
            <div class="logo-wrapper mb-3">
              <i class="fa fa-lock fa-3x text-primary"></i>
            </div>
            <h1 class="fw-bold mb-2">Set Your Password</h1>
            <p class="text-muted">Create a strong password for your account</p>
          </div>

          <form [formGroup]="formGroup" (ngSubmit)="setPassword()">

            @if (errorMessage) {
              <div class="alert alert-danger alert-dismissible fade show">
                <i class="fa fa-exclamation-circle me-2"></i>
                {{ errorMessage }}
                <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
              </div>
            }

            <!-- Email (read-only) -->
            <div class="form-floating mb-3">
              <input
                type="email"
                id="email"
                class="form-control"
                formControlName="email"
                readonly
              />
              <label for="email">
                <i class="fa fa-envelope me-2"></i>Email Address
              </label>
            </div>

            <!-- New Password -->
            <div class="form-floating mb-3">
              <input
                [type]="showPassword ? 'text' : 'password'"
                id="password"
                class="form-control"
                placeholder="Password"
                formControlName="password"
                [class.is-invalid]="formGroup.controls.password.invalid && formGroup.controls.password.touched"
              />
              <label for="password">
                <i class="fa fa-lock me-2"></i>New Password
              </label>

              <button
                type="button"
                class="password-toggle"
                (click)="showPassword = !showPassword"
                tabindex="-1"
              >
                <i class="fa" [class.fa-eye]="!showPassword" [class.fa-eye-slash]="showPassword"></i>
              </button>

              @if (formGroup.controls.password.hasError('required') && formGroup.controls.password.touched) {
                <div class="invalid-feedback">
                  Password is required
                </div>
              }

              @if (formGroup.controls.password.hasError('minlength') && formGroup.controls.password.touched) {
                <div class="invalid-feedback">
                  Password must be at least 8 characters
                </div>
              }
            </div>

            <!-- Confirm Password -->
            <div class="form-floating mb-3">
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                id="password_confirmation"
                class="form-control"
                placeholder="Confirm Password"
                formControlName="password_confirmation"
                [class.is-invalid]="(formGroup.controls.password_confirmation.invalid && formGroup.controls.password_confirmation.touched) || (!passwordsMatch && formGroup.controls.password_confirmation.touched)"
              />
              <label for="password_confirmation">
                <i class="fa fa-lock me-2"></i>Confirm Password
              </label>

              <button
                type="button"
                class="password-toggle"
                (click)="showConfirmPassword = !showConfirmPassword"
                tabindex="-1"
              >
                <i class="fa" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
              </button>

              @if (!passwordsMatch && formGroup.controls.password_confirmation.touched) {
                <div class="invalid-feedback d-block">
                  Passwords do not match
                </div>
              }
            </div>

            <!-- Password Requirements -->
            <div class="password-requirements mb-4">
              <small class="text-muted">
                <i class="fa fa-info-circle me-1"></i>
                Password must be at least 8 characters long
              </small>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              class="btn btn-primary w-100 py-3 mb-3"
              [disabled]="formGroup.invalid || !passwordsMatch || isLoading"
            >
              @if (isLoading) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Setting Password...
              } @else {
                <i class="fa fa-check me-2"></i>
                Set Password
              }
            </button>

            <div class="text-center">
              <a routerLink="/login" class="text-decoration-none">
                <i class="fa fa-arrow-left me-1"></i>
                Back to Login
              </a>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>
